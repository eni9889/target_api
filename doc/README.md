## Документация по API

API позволяет автоматизировать многие классы задач для
технологичных рекламных агентств и прямых клиентов,
а также позволяет широкому кругу сторонних разработчиков задействовать
возможности сервиса.

### Возможности

Доступ к API позволяет агентствам, рекламным платформам и прямым рекламодателям
автоматизировать управление рекламными кампаниями в сервисе.

Функциональность API полностью соответствует возможностям интерфейса.
В частности, через API можно создавать и редактировать рекламные кампании и
объявления, управлять их статусом — запускать, останавливать, архивировать.
Через программный интерфейс можно получать информацию о показателях и состоянии
каждого объявления, вплоть до причины отказа в случае, если баннер не прошел
модерацию.

Через API доступны все виды таргетингов, которые предлагает сервис. Протокол
позволяет выбрать аудиторию по площадкам, полу, возрасту, географии, истории
платежей и потребления игр, интересам, дням рождения и некоторым другим
факторам.

Кроме того, при помощи API можно вносить изменения в общие настройки кампании —
например, выбирать модель оплаты за показы или переходы, настраивать лимиты
бюджета и интенсивность трансляции объявлений кампании. Также в API доступен
выбор аукционных стратегий, которые определяют участие баннеров в аукционе.

### Типовые примеры использования

1. Автоматизированное управление ставками по собственным стратегиям. Например,
   единая ставка сразу на группу кампаний.
2. Пакетное редактирование объявлений, например, замена «скидка 30%» на
   «скидака 50%».
3. Разработка платформы управления таргетированной рекламой.

### Устройство

API реализован в виде набора «[ресурсов](/doc/api/detailed/#resources)»
(объектов предметной области) и «методов» (операций над ресурсами), что в
некоторой степени соответствует REST-идеологии. Основным отличием является то,
что многие методы позволяют оперировать ресурсами со сложной структурой,
включающей в себя другие ресурсы с произвольным уровнем вложенности или списки
других ресурсов. Многие методы также поддерживают операции над несколькими
ресурсами одного типа.

Каждый ресурс имеет один или несколько типов URL-адресов. Различные операции
над ресурсом реализованы в виде различных методов протокола HTTP. Например,
получение списка рекламных кампаний:

    GET /api/v1/campaigns.json

Создание кампании:

    POST /api/v1/campaigns.json

Получение параметров конкретной кампании:

    GET /api/v1/campaigns/1.json

Для подавляющего большинства методов входные и выходные данные представлены в
формате JSON. Соответственно, HTTP-запросы и ответы имеют тип
`application/json`. Для GET или DELETE запросов, не имеющих тела, тип
указывать необязательно.

Для валидации входных и генерации выходных данных для каждого ресурса описана
одна или несколько «[структур данных](/doc/api/detailed/#objects)». В описании
каждого метода указано, какими структурами он оперирует.

#### Аутентификация

Для аутентификации и авторизации в API используется протокол OAuth2.
Его реализация описана в [отдельной статье](/doc/api/oauth2).
Регистрация клиентов для работы с API через OAuth2 пока осуществляется в ручном
режиме по заявке в саппорт из интерфейса сервиса.

#### Базовые типы данных

API оперирует следующим набором базовых типов данных:

Тип данных                        | JSON-представление
--------------------------------- | ------------------------------
Строка (String)                   | ``"value"``
Целое число (Integer)             | ``123``
Десятичная дробь (Decimal)        | ``"1.23"``
Булево значение (Boolean)         | ``true`` или ``false``
Ничего (None)                     | ``null``
Дата (Date)                       | ``"2013-08-18"``, формат ``YYYY-MM-DD``, если явно не указан другой
Дата и время (Datetime)           | ``"2013-08-28 16:49:34"``, формат `YYYY-MM-DD HH:MM:SS` если явно не указан другой, временная зона `Europe/Moscow`, если не указана другая
Список (List)                     | ``["value1", "value2"]``, элементы списка однородны
Объект (Object)                   | ``{"id": 1, "name": "Name"}``, свойства объекта могут быть неоднородны

Сложные типы данных, основанные на базовых, описаны в
[документации по методам и ресурсам](/doc/api/detailed/).

#### Базовые ошибки

Ответы с ошибками имеют стандартные статусы HTTP-ответов.
В теле ответа при этом указана более подробная информация об ошибке в формате
JSON (тип ответа-ошибки — ``application/json``).

* ``400`` — ошибка валидации структуры данных, присланной в запросе;
* ``401`` — отсутствие подписи для осуществления аутентификации или же
    неправильное её значение;
* ``403`` — операция запрещена для аккаунта, чьим секретным ключом был подписан
    запрос;
* ``404`` — запрашиваемый ресурс не найден;
* ``405`` — ресурс не поддерживает данный HTTP-метод;
* ``413`` — тело запроса слишком велико;
* ``429`` — превышение лимита на количество запросов в единицу времени;
* ``500`` — непредвиденная ошибка.

#### Сжатие ответа
Если ваш клиент поддерживает сжатие, в запросе можно передавать заголовок:

    Accept-Encoding: gzip, deflate


#### Лимиты на количество запросов в единицу времени
Сервис ограничивает количество запросов в единицу времени.
Ограничения действуют для промежутков времени, равных секунде, часу и дню.
Ограничения привязаны к календарным периодам времени.
Текущние ограничения можно получить с помощью HTTP заголовков ответа:

    X-RateLimit-RPS-Limit: value     # количество запросов в секунду
    X-RateLimit-Hourly-Limit: value  # количество запросов в час
    X-RateLimit-Daily-Limit: value   # количество запросов в день

Количество запросов, которое можно произвести до окончания периода, можно получить c помощью HTTP заголовков ответа:

    X-RateLimit-RPS-Remaining: value    # сколько запросов можно произвести до окончания текущей секунды
    X-RateLimit-Hourly-Remaining: value # сколько запросов можно произвести до окончания текущего часа
    X-RateLimit-Daily-Remaining: value  # сколько запросов можно произвести до окончания текущего дня

#### Тестирование
Для тестирования работы с API существует отдельный тестовый экземпляр сервиса:
``target-sandbox.my.com``. Идентификатор доступа и секретный ключ для работы с
ним отличаются от тех, что используются для доступа к основному сервису.

#### Ссылки
* [Подробная документация по методам и ресурсам](/doc/api/detailed/)
* [Примерные реализации клиентов на разных языках программирования](https://github.com/wreckah/target_api)

*[HMAC]: Hash-based Message Authentication Code
*[HTTP]: HyperText Transfer Protocol
*[JSON]: JavaScript Object Notation
*[REST]: REpresentational State Transfer
*[SHA1]: Secure Hash Algorithm 1
